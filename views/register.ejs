<!DOCTYPE html>
<html>
  <%- include("partials/head.ejs") %>
  <body>
    <div class="container mx-auto flex justify-center items-center h-screen">
      <form class="w-4/12" id="register">
        <legend>Register</legend>
        <% if (locals.error) { %>
        <div class="bg-rose-100 text-rose-600 mb-2 border-2 border-rose-600">
          <%- error.password %>
        </div>
        <% } %>
        <fieldset class="bg-white border-2 border-gray-100 p-2 mb-4">
          <div class="mb-5">
            <input type="text" name="email" id="email" placeholder="E-mail" />
          </div>
          <div class="mb-5">
            <input
              type="password"
              name="password"
              id="password"
              placeholder="Password"
              autocomplete="off"
            />
          </div>
          <div>
            <input
              type="password"
              name="passwordConfirm"
              id="passwordConfirm"
              placeholder="Confirm Password"
              autocomplete="off"
            />
          </div>
        </fieldset>
        <div>
          <button class="w-full">Create an account</button>
        </div>
      </form>
    </div>

    <script>
      const formRegister = document.querySelector("#register");

      formRegister.addEventListener("submit", (event) => {
        event.preventDefault();

        const payload = {
          email: document.querySelector("#email").value,
          password: document.querySelector("#password").value,
          passwordConfirm: document.querySelector("#passwordConfirm").value,
        };

        const options = {
          credentials: "same-origin",
          headers: {
            "Content-Type": "application/json",
          },
        };

        fetch("/register", {
          ...options,
          method: "POST",
          body: JSON.stringify(payload),
        })
          .then(function (response) {
            if (response.ok) {
              return response.json();
            }
            return Promise.reject(response);
          })
          .then(function (data) {
            console.log(data);
          })
          .catch(function (error) {
            console.warn(error);
          });
      });
    </script>
  </body>
</html>
